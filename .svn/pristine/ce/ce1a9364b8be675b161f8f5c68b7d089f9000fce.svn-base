<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:include="include :: header('新增合同')"/>
    <th:block th:include="include :: select2-css"/>
</head>
<body>
<div class="form-content">
    <form id="form-contract-add" class="form-horizontal">
        <input id="dealer" name="jxs" type="hidden"/>
        <h4 class="form-header h4">基本信息</h4>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>合同编号(TL-X-)：</label>
                    <div class="col-sm-8">
                        <input name="htbh" placeholder="请输入合同编号" class="form-control" type="text" maxlength="64" required>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>经销商：</label>
                    <div class="col-sm-8">
                        <div class="input-group">
                            <input class="form-control" name="jxs" type="text" onclick="selectDealerTree()" id="treeName" readonly="true">
                            <span class="input-group-addon"><i class="fa fa-search"></i></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>我方同签订(分公司或总公司)：</label>
                    <div class="col-sm-8">
                        <div class="input-group" style="width: 100%">
                            <select name="wftqd" class="form-control m-b"
                                    th:with="type=${@dict.getType('dm_dj_wftqd')}">
                                <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                                        th:value="${dict.dictValue}"></option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>返利归口(经销商)：</label>
                    <div class="col-sm-8">
                        <input name="flgk" class="form-control" type="text" maxlength="50" placeholder="请输入返利归口(经销商)" required>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>业务归口(销售经理)：</label>
                    <div class="col-sm-8">
                        <input name="ywgk" placeholder="请输入业务归口(销售经理)" class="form-control" type="text" maxlength="30"
                               required>
                    </div>
                </div>
            </div>
        </div>
        <h4 class="form-header h4">车辆信息</h4>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>车型号：</label>
                    <div class="col-sm-8">
                        <input name="clxhDm" placeholder="请输入车型号" class="form-control" type="text" maxlength="15"
                               required>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>合同单价：</label>
                    <div class="col-sm-8">
                        <input id="htdj" name="htdj" placeholder="请输入合同单价" class="form-control" type="text" maxlength="18"
                               required>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>数量：</label>
                    <div class="col-sm-8">
                        <input name="sl" placeholder="请输入总数量" class="form-control" type="text" maxlength="15" required>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>合同总金额：</label>
                    <div class="col-sm-8">
                        <input name="htzje" placeholder="请输入合同总金额" class="form-control" type="text" maxlength="18"
                               required>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>经销商与客户价格：</label>
                    <div class="col-sm-8">
                        <input name="jxsykhjg" placeholder="请输入经销商与客户价格" class="form-control" type="text" maxlength="15"
                               required>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>随车配件：</label>
                    <div class="col-sm-8">
                        <input name="scpj" placeholder="请输入随车配件" class="form-control" type="text" maxlength="18"
                               required>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>核算单价(交货价)：</label>
                    <div class="col-sm-8">
                        <input name="hsdj" placeholder="请输入核算单价(交货价)" class="form-control" type="text" maxlength="15"
                               required>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>运输方式：</label>
                    <div class="col-sm-8">
                        <div class="input-group" style="width: 100%">
                            <select name="ysfsDm" class="form-control m-b" th:with="type=${@dict.getType('dm_dj_ysfs')}">
                                <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                                        th:value="${dict.dictValue}"></option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>合同单价是否含运费：</label>
                    <div class="col-sm-8">
                        <div class="input-group" style="width: 100%">
                            <select name="htdjsfhyf" class="form-control m-b"
                                    th:with="type=${@dict.getType('dm_dj_sf')}">
                                <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                                        th:value="${dict.dictValue}"></option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>运费单价(元/台)：</label>
                    <div class="col-sm-8">
                        <input name="yfdj" placeholder="请输入运费单价" class="form-control" type="text" maxlength="18"
                               required>
                    </div>
                </div>
            </div>
        </div>
<!--        <div class="row">-->
<!--            <div class="col-sm-6">-->
<!--                <div class="form-group">-->
<!--                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>未发车数：</label>-->
<!--                    <div class="col-sm-8">-->
<!--                        <input name="wfcs" placeholder="请输入未发车数" class="form-control" type="text" maxlength="15"-->
<!--                               required>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--            <div class="col-sm-6">-->
<!--                <div class="form-group">-->
<!--                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>已发车数：</label>-->
<!--                    <div class="col-sm-8">-->
<!--                        <input name="yfts" placeholder="请输入已发车数" class="form-control" type="text" maxlength="18"-->
<!--                               required>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>出门日期(或计划发车时间)：</label>
                    <div class="col-sm-8">
                        <input type="text" class="time-input form-control" placeholder="请选择出门日期(或计划发车时间)"
                               name="cmrq"/>
                    </div>
                </div>
            </div>
            <!-- 此项为待定项 -->
<!--            <div class="col-sm-6">-->
<!--                <div class="form-group">-->
<!--                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>出门证号：</label>-->
<!--                    <div class="col-sm-8">-->
<!--                        <input name="cmzh" placeholder="请输入出门证号" class="form-control" type="text" maxlength="18"-->
<!--                               required>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
        </div>
        <h4 class="form-header h4">款项信息</h4>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>付款方式：</label>
                    <div class="col-sm-8">
                        <div class="input-group" style="width: 100%">
                            <select name="fkfsDm" class="form-control m-b" th:with="type=${@dict.getType('dm_dj_fkfs')}">
                                <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                                        th:value="${dict.dictValue}"></option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>管理费：</label>
                    <div class="col-sm-8">
                        <input name="glf" placeholder="请输入管理费" class="form-control" type="text" maxlength="18" required>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>利息：</label>
                    <div class="col-sm-8">
                        <input name="lx" placeholder="请输入利息" class="form-control" type="text" maxlength="18" required>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>质保金到期时间：</label>
                    <div class="col-sm-8">
                        <input type="text" class="time-input form-control" placeholder="请选择质保金到期时间"
                               name="zbjdqsj"/>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12">
                <div class="form-group">
                    <label class="col-xs-2 control-label">约定付款条件：</label>
                    <div class="col-xs-10">
                        <textarea name="ydfktj" maxlength="500" class="form-control" rows="2"></textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>是否记销量：</label>
                    <div class="col-sm-8">
                        <div class="input-group" style="width: 100%">
                            <select name="sfjxl" class="form-control m-b" th:with="type=${@dict.getType('dm_dj_sf')}">
                                <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                                        th:value="${dict.dictValue}"></option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>质保金：</label>
                    <div class="col-sm-8">
                        <input name="zbj" placeholder="请输入质保金" class="form-control" type="text" maxlength="18" required>
                    </div>
                </div>
            </div>
        </div>
        <h4 class="form-header h4">协议信息</h4>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>签订日期：</label>
                    <div class="col-sm-8">
                        <input type="text" class="time-input form-control" placeholder="请选择签订日期" name="qdrq" required/>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>合同原件：</label>
                    <div class="col-sm-8">
                        <div class="radio-box" th:each="dict : ${@dict.getType('dm_dj_xyzt')}">
                            <input type="radio" th:id="${dict.dictCode}" name="htyj" th:value="${dict.dictValue}"
                                   th:checked="${dict.isDefault == 'Y' ? true : false}">
                            <label th:for="${dict.dictCode}" th:text="${dict.dictLabel}"></label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>技术协议：</label>
                    <div class="col-sm-8">
                        <div class="radio-box" th:each="dict : ${@dict.getType('dm_dj_xyzt')}">
                            <input type="radio" th:id="${dict.dictCode}" name="jsxy" th:value="${dict.dictValue}"
                                   th:checked="${dict.isDefault == 'Y' ? true : false}">
                            <label th:for="${dict.dictCode}" th:text="${dict.dictLabel}"></label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>服务协议：</label>
                    <div class="col-sm-8">
                        <div class="radio-box" th:each="dict : ${@dict.getType('dm_dj_xyzt')}">
                            <input type="radio" th:id="${dict.dictCode}" name="fwxy" th:value="${dict.dictValue}"
                                   th:checked="${dict.isDefault == 'Y' ? true : false}">
                            <label th:for="${dict.dictCode}" th:text="${dict.dictLabel}"></label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>担保书：</label>
                    <div class="col-sm-8">
                        <div class="radio-box" th:each="dict : ${@dict.getType('dm_dj_xyzt')}">
                            <input type="radio" th:id="${dict.dictCode}" name="dbs" th:value="${dict.dictValue}"
                                   th:checked="${dict.isDefault == 'Y' ? true : false}">
                            <label th:for="${dict.dictCode}" th:text="${dict.dictLabel}"></label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>合同评审：</label>
                    <div class="col-sm-8">
                        <div class="radio-box" th:each="dict : ${@dict.getType('dm_dj_xyzt')}">
                            <input type="radio" th:id="${dict.dictCode}" name="htps" th:value="${dict.dictValue}"
                                   th:checked="${dict.isDefault == 'Y' ? true : false}">
                            <label th:for="${dict.dictCode}" th:text="${dict.dictLabel}"></label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>客户：</label>
                    <div class="col-sm-8">
                        <input name="kh" placeholder="请输入客户" class="form-control" type="text" required>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>工地名称：</label>
                    <div class="col-sm-8">
                        <input name="gdmc" placeholder="请输入工地名称" class="form-control" type="text" required>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>约定提车日：</label>
                    <div class="col-sm-8">
                        <input type="text" class="time-input form-control" placeholder="请选择约定提车日"
                               name="ydtcr" date-format="YYYY-MM-dd"/>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label class="col-sm-4 control-label"><span style="color: red; ">*</span>服务方式或服务商：</label>
                    <div class="col-sm-8">
                        <div class="input-group" style="width: 100%">
                            <select name="fwfshfws" class="form-control m-b" th:with="type=${@dict.getType('dm_dj_fwfs')}">
                                <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                                        th:value="${dict.dictValue}"></option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <h4 class="form-header h4">其他信息</h4>
        <div class="row">
            <div class="col-sm-12">
                <div class="form-group">
                    <label class="col-xs-2 control-label">服务期限或特殊约定：</label>
                    <div class="col-xs-10">
                        <textarea name="fwqxhtsyd" maxlength="500" class="form-control" rows="2"></textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12">
                <div class="form-group">
                    <label class="col-xs-2 control-label">备注：</label>
                    <div class="col-xs-10">
                        <textarea name="bz" maxlength="500" class="form-control" rows="3"></textarea>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<div class="row">
    <div class="col-sm-offset-5 col-sm-10">
        <button type="button" class="btn btn-sm btn-primary" onclick="submitHandler()"><i class="fa fa-check"></i>保 存
        </button>&nbsp;
        <button type="button" class="btn btn-sm btn-danger" onclick="closeItem()"><i class="fa fa-reply-all"></i>关 闭
        </button>
    </div>
</div>
<th:block th:include="include :: footer"/>
<th:block th:include="include :: select2-js"/>
<script>
    var prefix = ctx + "contractmanage/contractentry";

    $("#form-contract-add").validate({

        onkeyup: false,
        rules: {
            loginName: {
                minlength: 2,
                maxlength: 20,
                remote: {
                    url: prefix + "/checkLoginNameUnique",
                    type: "post",
                    dataType: "json",
                    data: {
                        name: function () {
                            return $.common.trim($("#loginName").val());
                        }
                    },
                    dataFilter: function (data, type) {
                        return $.validate.unique(data);
                    }
                }
            },
            password: {
                minlength: 5,
                maxlength: 20
            },
            email: {
                email: true,
                remote: {
                    url: prefix + "/checkEmailUnique",
                    type: "post",
                    dataType: "json",
                    data: {
                        name: function () {
                            return $.common.trim($("#email").val());
                        }
                    },
                    dataFilter: function (data, type) {
                        return $.validate.unique(data);
                    }
                }
            },
            phonenumber: {
                isPhone: true,
                remote: {
                    url: prefix + "/checkPhoneUnique",
                    type: "post",
                    dataType: "json",
                    data: {
                        name: function () {
                            return $.common.trim($("#phonenumber").val());
                        }
                    },
                    dataFilter: function (data, type) {
                        return $.validate.unique(data);
                    }
                }
            },
            htbh:{
                number:true,
                minlength:7,
                maxlength:7,
                remote: {
                    url: prefix + "/checkHtbhUnique",
                    type: "post",
                    dataType: "json",
                    data: {
                        name: function () {
                            return $.common.trim($("#htbh").val());
                        }
                    },

                    dataFilter: function (data, type) {
                        return $.validate.unique(data);
                    }
                }
            },
            // jxs:{
            //     required:true,
            //     maxlength:50
            // },
            // wftqd:{
            //     required:true
            // },
            // flgk:{
            //     required:true
            // },
            // ywgk:{
            //     required:true
            // },
            clxhDm:{
                required:true,
                vType:true
            },
            htdj:{
                required:true,
                number:true,
                money:true
            },
            sl:{
                required:true,
                number:true,
                count:true
            },
            htzje:{
                required:true,
                number:true,
                money:true
            },
            jxsykhjg:{
                required:true,
                number:true,
                money:true
            },
            scpj:{
                required:true,
                number:true
            },
            hsdj:{
                number:true,
                money:true,
            },
            // ysfs:{
            //     required:true
            // },
            htdjsfhyf:{
                required:true
            },
            yfdj:{
                required:true,
                number:true
            },
            // wfcs:{
            //     required:true
            // },
            // yfts:{
            //     required:true
            // },
            // cmrq:{
            //     required:true
            // },
            cmzh:{
                required:true,
                number:true
            },
            fkfs:{
                required:true
            },
            glf:{
                required:true,
                number:true
,            },
            lx:{
                required:true,
                number:true
            },
            sfjxl:{
                required:true
            },
            zbj:{
                required:true,
                number:true
            },
            kh:{
                required:true
            },
            gdmc:{
                required:true
            },
            ydtcr:{
                required:true
            },
            fwfshfws:{
                required:true
            }

        },
        messages: {
            "loginName": {
                remote: "用户已经存在"
            },
            "email": {
                remote: "Email已经存在"
            },
            "phonenumber": {
                remote: "手机号码已经存在"
            },
             "htbh":{
                remote:"合同编号已存在"
             }
        },
        focusCleanup: true
    });

    function submitHandler() {

        $.operate.saveTab(prefix + "/add", $('#form-contract-add').serialize());

        // if ($.validate.form()) {
        //     var data = $("#form-user-add").serializeArray();
        //     var status = $("input[id='status']").is(':checked') == true ? 0 : 1;
        //     var roleIds = $.form.selectCheckeds("role");
        //     var postIds = $.form.selectSelects("post");
        //     data.push({"name": "status", "value": status});
        //     data.push({"name": "roleIds", "value": roleIds});
        //     data.push({"name": "postIds", "value": postIds});
        //     $.operate.saveTab(prefix + "/add", data);
        // }
    }

    /*经销商管理-新增-选择父经销商树*/
    function selectDealerTree() {
        var options = {
            title: '经销商选择',
            width: "380",
            url:  ctx + "basics/dealer/selectDealerTree/" + 100,
            callBack: doSubmit
        };
        $.modal.openOptions(options);
    }

    function doSubmit(index, layero){
        var body = layer.getChildFrame('body', index);
        $("#dealer").val(body.find('#treeId').val());
        $("#treeName").val(body.find('#treeName').val());
        layer.close(index);
    }

</script>
</body>
</html>
